
SET(BUILD_BIN_TYPE_DIR ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${CMAKE_CONFIGURATION_TYPES})
SET(BUILD_INCLUDE_DIR ${BUILD_DIR}/include)
SET(BUILD_INSTALL_DIR ${BUILD_DIR}/install)

MESSAGE(STATUS "BUILD_DIR: " ${BUILD_DIR})
MESSAGE(STATUS "BUILD_INCLUDE_DIR: " ${BUILD_INCLUDE_DIR})
MESSAGE(STATUS "BUILD_INSTALL_DIR: " ${BUILD_INSTALL_DIR})


ADD_SUBDIRECTORY(MyLib)

MESSAGE(STATUS "project: " ${CMAKE_PROJECT_NAME} )
MESSAGE(STATUS "headers: " ${library_hdr} )
MESSAGE(STATUS "sources: " ${library_src} )

FIND_PACKAGE(Qt5 COMPONENTS Widgets REQUIRED)

ADD_LIBRARY(${CMAKE_PROJECT_NAME} SHARED
	${library_hdr}
	${library_src}
	${library_res}
)

ADD_CUSTOM_COMMAND(TARGET ${CMAKE_PROJECT_NAME}
	POST_BUILD
	COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_INCLUDE_DIR}
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ${library_hdr} ${BUILD_INCLUDE_DIR}
)

TARGET_INCLUDE_DIRECTORIES(${CMAKE_PROJECT_NAME} PUBLIC ${BUILD_INCLUDE_DIR})

QT_ADDMODULE(${CMAKE_PROJECT_NAME} Core)
#QT_ADDMODULE(${CMAKE_PROJECT_NAME} Gui)
QT_ADDMODULE(${CMAKE_PROJECT_NAME} Widgets)

ADD_CUSTOM_COMMAND(TARGET ${CMAKE_PROJECT_NAME}
	POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
	$<TARGET_FILE:Qt5::Core> ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${CMAKE_CONFIGURATION_TYPES}
	$<TARGET_FILE:Qt5::Widgets> ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${CMAKE_CONFIGURATION_TYPES}
)

INSTALL(TARGETS ${CMAKE_PROJECT_NAME} 
	RUNTIME DESTINATION install
	#COMPONENT applications
)

# PACKAGE SETUP ###################################################

INCLUDE(CMakePackageConfigHelpers)

CONFIGURE_PACKAGE_CONFIG_FILE(
	${CMAKE_SOURCE_DIR}/src/${CMAKE_PROJECT_NAME}Config.cmake.in
	${CMAKE_BINARY_DIR}/src/${CMAKE_PROJECT_NAME}Config.cmake
	INSTALL_DESTINATION ${BUILD_INSTALL_DIR}
	PATH_VARS BUILD_DIR
)
	
#CONFIGURE_PACKAGE_CONFIG_FILE(
#	${CMAKE_SOURCE_DIR}/src/${CMAKE_PROJECT_NAME}Config.cmake
#	${BUILD_DIR}/${CMAKE_PROJECT_NAME}Config.cmake
#	INSTALL_DESTINATION ${BUILD_INSTALL_DIR}
#)

EXPORT(TARGETS ${CMAKE_PROJECT_NAME}
	FILE ${BUILD_DIR}/lib/${CMAKE_CONFIGURATION_TYPES}/${CMAKE_PROJECT_NAME}Targets.cmake
)

EXPORT(PACKAGE ${CMAKE_PROJECT_NAME})

